<!DOCTYPE html>
<html>
<head>
    <title>MAXMATE - Details</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>

<body style="background-color: #141414; color: white; margin: 0; padding: 0;">

    <input type="hidden" id="my-movie-id" value="{{ movie_id }}">

    <nav class="navbar-custom" style="position: absolute; background: transparent; box-shadow: none;">
        <div class="logo" onclick="window.location.href='{{ url_for('home') }}'">MAXMATE</div>
        <div class="nav-right">
             <a href="{{ url_for('profile') }}" class="profile-icon" style="color: white; text-decoration: none;">
                <i class="material-icons">account_circle</i>
            </a>
            <a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
        </div>
    </nav>

    <a href="{{ url_for('home') }}" class="back-btn" style="top: 80px;"><i class="fa fa-arrow-left"></i> Back</a>

    <div class="details-hero" style="background-image: url('{{poster}}');">
        <div class="details-overlay"></div>

        <div class="details-content">
            <div class="poster-container">
                <img src="{{poster}}" alt="Poster" class="main-poster">
            </div>

            <div class="info-container">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <h1 class="movie-title">{{title}}</h1>

                    <div class="action-buttons">
                        <i class="fa fa-heart action-icon btn-like {% if is_liked %}liked{% endif %}"
                           id="like-btn"
                           onclick="toggleAction(this, 'like', '{{ movie_id }}', '{{ title }}', '{{ poster }}')"
                           title="Like"></i>

                        <i class="fa fa-bookmark action-icon btn-save {% if is_saved %}saved{% endif %}"
                           id="save-btn"
                           onclick="toggleAction(this, 'save', '{{ movie_id }}', '{{ title }}', '{{ poster }}')"
                           title="Watchlist"></i>
                    </div>
                </div>

                <div class="meta-data">
                    <span class="badge badge-light">{{release_date}}</span>
                    <span class="badge badge-warning">â˜… {{vote_average}}/10</span>
                    <span class="runtime">{{runtime}}</span>
                </div>
                <p class="genre-tag">{{genres}}</p>
                <p class="movie-overview">{{overview}}</p>
                <p class="status-text">Status: {{status}}</p>
            </div>
        </div>
    </div>

    {% if casts|length > 1 %}
    <div class="section-container">
       <h3>Cast</h3>
       <div class="movie-content">
           {% for name, details in casts.items() if not casts.hidden %}
             <div class="castcard" data-toggle="modal" data-target="#{{details[0]}}">
                 <img class="card-img-top" src="{{details[2]}}" alt="{{name}}" onerror="this.src='https://placehold.co/300x450?text=No+Photo'">
                 <div class="card-body">
                   <h5 class="card-title">{{name|title}}</h5>
                   <p class="sub-text">as {{details[1]|title}}</p>
                 </div>
             </div>

             <div class="modal fade" id="{{details[0]}}" tabindex="-1" role="dialog" aria-hidden="true" style="color: black;">
               <div class="modal-dialog modal-lg" role="document">
                 <div class="modal-content" style="background-color: #f0f0f0;">

                   <div class="modal-header" style="color: white;">
                     <h5 class="modal-title">{{name}}</h5>
                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                       <span aria-hidden="true" style="color: white">&times;</span>
                     </button>
                   </div>

                   <div class="modal-body">
                     <div class="container-fluid">
                       <div class="row">
                         <div class="col-md-5">
                           <img src="{{details[2]}}" class="img-fluid rounded"
                                style="width: 100%; box-shadow: 0 5px 15px rgba(0,0,0,0.3);"
                                onerror="this.src='https://placehold.co/300x450?text=No+Photo'">
                         </div>
                         <div class="col-md-7">
                           <ul class="list-group list-group-flush" style="background: transparent;">
                             <li class="list-group-item" style="background: transparent;">
                               <strong>Birthday:</strong> {{details[3]}}
                             </li>
                             <li class="list-group-item" style="background: transparent;">
                               <strong>Place of Birth:</strong> {{details[4]}}
                             </li>
                             <li class="list-group-item" style="background: transparent;">
                               <strong>Biography:</strong><br>
                               <span style="font-size: 0.9rem; display: block; max-height: 300px; overflow-y: auto;">
                                 {{details[5]}}
                               </span>
                             </li>
                           </ul>
                         </div>
                       </div>
                     </div>
                   </div>

                   <div class="modal-footer">
                     <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                   </div>

                 </div>
               </div>
             </div>
           {% endfor %}
       </div>
    </div>
    {% endif %}

    {% if movie_cards|length > 1 %}
    <div class="section-container">
       <h3>More Like This</h3>
       <div class="movie-content">
         {% for poster, title in movie_cards.items() if not movie_cards.hidden %}
           <div class="card" onclick="recommendcard(this)" title="{{title}}">
               <img class="card-img-top" src="{{poster}}" alt="{{title}}" onerror="this.src='https://placehold.co/300x450?text=No+Image'">
               <div class="card-body">
                  <h5 class="card-title">{{title|capitalize}}</h5>
               </div>
           </div>
         {% endfor %}
       </div>
    </div>
    {% endif %}

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="text/javascript" src="{{url_for('static', filename='recommend.js')}}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <div id="chat-circle" class="btn btn-raised">
      <img src="{{ url_for('static', filename='chatbot-icon.png') }}" alt="AI Chat">
  </div>

  <div class="chat-box">
      <div class="chat-box-header">
          Hey Max
          <span class="chat-box-toggle"><i class="material-icons">close</i></span>
      </div>
      <div class="chat-box-body">
          <div class="chat-logs">
              <div class="chat-msg bot">
                  <span class="cm-msg-text">Hi! I'm your movie assistant. Ask me anything!</span>
              </div>
          </div>
      </div>
      <div class="chat-input">
          <form style="display: flex; width: 100%;">
              <input type="text" id="chat-input" placeholder="Find a movie..." />
              <button type="submit" class="chat-submit" id="chat-submit">
                  <i class="material-icons">send</i>
              </button>
          </form>
      </div>
  </div>

</body>
</html>