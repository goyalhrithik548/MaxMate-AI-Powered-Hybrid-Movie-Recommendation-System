<!DOCTYPE html>
<html>
<head>
  <title>MAXMATE - Home</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='style.css') }}">

  <script type="text/javascript">
    var films = {{suggestions|tojson}};
  </script>
</head>

<body style="background-color: #141414; color: white; margin:0;">

    <nav class="navbar-custom">
        <div class="logo">MAXMATE</div>
        <div class="nav-right">
            <div class="search-box-container">
                <i class="fa fa-search search-icon"></i>
                <input type="text" id="autoComplete" autocomplete="off" placeholder="Titles, people, genres">
            </div>
            <button id="search-btn" class="movie-button" style="display:none;" disabled>Search</button>

            <a href="{{ url_for('profile') }}" class="profile-icon" style="color: white; text-decoration: none; display: flex; align-items: center;">
                <i class="material-icons" style="font-size: 30px;">account_circle</i>
            </a>

            <a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
        </div>
    </nav>

    <header class="hero" id="hero-section" data-id="{{ hero.id }}" style="background-image: linear-gradient(to top, #141414 10%, transparent 90%), url('https://via.placeholder.com/1920x1080?text=Loading...');">
        <div class="hero-content">
            <h1 class="hero-title">{{ hero.title }}</h1>
            <p class="hero-overview" id="hero-desc">{{ hero.overview }}</p>
            <div class="hero-buttons">
                <button class="btn btn-secondary btn-lg" onclick="recommend('{{ hero.title }}', '{{ hero.id }}')" style="background-color: rgba(109, 109, 110, 0.7); color: white; border: none;">
                    <i class="fa fa-info-circle"></i> More Info
                </button>
            </div>
        </div>
    </header>

    <div class="main-content">

        {% if recommendations %}
        <div class="category-section">
            <h3 style="color: #46d369;">Recommended For You</h3>
            <div class="carousel-container">
                <button class="nav-btn left" onclick="scrollContainer('rec-list', -300)">&#10094;</button>
                <div class="movie-list" id="rec-list">
                    {% for movie in recommendations %}
                    <div class="movie-card" onclick="recommend('{{ movie.title }}', '{{ movie.id }}')">
                        <img class="tmdb-poster" data-id="{{ movie.id }}" src="https://placehold.co/300x450?text=Loading..." alt="{{ movie.title }}">
                        <div class="card-overlay"><p>{{ movie.title }}</p></div>
                    </div>
                    {% endfor %}
                </div>
                <button class="nav-btn right" onclick="scrollContainer('rec-list', 300)">&#10095;</button>
            </div>
        </div>
        {% endif %}

        <div class="category-section">
            <h3>Trending Now</h3>
            <div class="carousel-container">
                <button class="nav-btn left" onclick="scrollContainer('trending-list', -300)">&#10094;</button>
                <div class="movie-list" id="trending-list">
                    {% for movie in trending %}
                    <div class="movie-card" onclick="recommend('{{ movie.title }}', '{{ movie.id }}')">
                        <img class="tmdb-poster" data-id="{{ movie.id }}" src="https://placehold.co/300x450?text=Loading..." alt="{{ movie.title }}">
                        <div class="card-overlay"><p>{{ movie.title }}</p></div>
                    </div>
                    {% endfor %}
                </div>
                <button class="nav-btn right" onclick="scrollContainer('trending-list', 300)">&#10095;</button>
            </div>
        </div>

        <div class="category-section">
            <h3>All Time Favorites</h3>
            <div class="carousel-container">
                <button class="nav-btn left" onclick="scrollContainer('classic-list', -300)">&#10094;</button>
                <div class="movie-list" id="classic-list">
                    {% for movie in classics %}
                    <div class="movie-card" onclick="recommend('{{ movie.title }}', '{{ movie.id }}')">
                        <img class="tmdb-poster" data-id="{{ movie.id }}" src="https://placehold.co/300x450?text=Loading..." alt="{{ movie.title }}">
                        <div class="card-overlay"><p>{{ movie.title }}</p></div>
                    </div>
                    {% endfor %}
                </div>
                <button class="nav-btn right" onclick="scrollContainer('classic-list', 300)">&#10095;</button>
            </div>
        </div>

    </div>

    <div id="loader" class="text-center" style="display:none;"></div>
    <div class="fail" style="display:none;"><center><h3>Sorry! try another movie name</h3></center></div>
    <div class="results" style="display:none;">
        <center><h2 id="name" class="text-uppercase"></h2></center>
    </div>

    <div class="footer" style="text-align: center; padding: 20px; color: #757575;">Project by <span style="color: #8e44ad;">Hrithik</span></div>

    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <script type="text/javascript" src="{{url_for('static', filename='autocomplete.js')}}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        const API_KEY = '8265bd1679663a7ea12ac168da84d2e8';

        document.addEventListener("DOMContentLoaded", function() {
            const posters = document.querySelectorAll('.tmdb-poster');
            posters.forEach(img => {
                const movieId = img.getAttribute('data-id');
                fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.poster_path) {
                            img.src = 'https://image.tmdb.org/t/p/w500' + data.poster_path;
                        } else {
                            img.src = 'https://placehold.co/300x450?text=No+Poster';
                        }
                    })
                    .catch(err => console.log('Poster Error:', err));
            });

            const heroSection = document.getElementById('hero-section');
            const heroId = heroSection.getAttribute('data-id');
            const heroDesc = document.getElementById('hero-desc');

            if (heroId && heroId != "0") {
                fetch(`https://api.themoviedb.org/3/movie/${heroId}?api_key=${API_KEY}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.backdrop_path) {
                            const bgUrl = 'https://image.tmdb.org/t/p/original' + data.backdrop_path;
                            heroSection.style.backgroundImage = `linear-gradient(to top, #141414 10%, transparent 90%), url('${bgUrl}')`;
                        }
                        if (heroDesc.innerText.trim() === "" || heroDesc.innerText === "None") {
                             heroDesc.innerText = data.overview || "Overview unavailable.";
                        }
                    })
                    .catch(err => console.log('Hero Error:', err));
            }
        });

        function scrollContainer(id, amount) {
            const container = document.getElementById(id);
            container.scrollBy({ left: amount, behavior: 'smooth' });
        }
    </script>
    <script type="text/javascript" src="{{url_for('static', filename='recommend.js')}}"></script>
<div id="chat-circle" class="btn btn-raised">
    <img src="{{ url_for('static', filename='chatbot-icon.png') }}" alt="AI Chat">
</div>

    <div class="chat-box">
        <div class="chat-box-header">
            Hey Max
            <span class="chat-box-toggle"><i class="material-icons">close</i></span>
        </div>
        <div class="chat-box-body">
            <div class="chat-logs">
                <div class="chat-msg bot">
                    <span class="cm-msg-text">Hi! I'm your movie assistant. Ask me anything!</span>
                </div>
            </div>
        </div>
        <div class="chat-input">
            <form style="display: flex; width: 100%;">
                <input type="text" id="chat-input" placeholder="Find a movie..." />
                <button type="submit" class="chat-submit" id="chat-submit">
                    <i class="material-icons">send</i>
                </button>
            </form>
        </div>
    </div>

</body>
</html>